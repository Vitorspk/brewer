# ===================================================================
# Production Profile - GCP Deployment
# ===================================================================
# This profile extends application-prod.properties with GCP-specific settings
# Activate with: SPRING_PROFILES_ACTIVE=prod-gcp
#
# Required Environment Variables:
# - DATABASE_URL: GCP Cloud SQL connection string
# - DATABASE_USERNAME: Cloud SQL username
# - DATABASE_PASSWORD: Cloud SQL password (REQUIRED)
# - GCP_PROJECT_ID: GCP project ID
# - GCP_STORAGE_BUCKET: Cloud Storage bucket name
# - GOOGLE_APPLICATION_CREDENTIALS: Path to service account JSON (optional, uses ADC in GKE)
# OR
# - GCP_CREDENTIALS_JSON: Inline service account JSON (recommended for containers)

# Include base production properties
spring.config.import=optional:application-prod.properties

# DataSource MySQL - GCP Cloud SQL
spring.datasource.url=${DATABASE_URL:jdbc:mysql://localhost:3306/brewer?useSSL=true&serverTimezone=UTC}
spring.datasource.username=${DATABASE_USERNAME:root}
spring.datasource.password=${DATABASE_PASSWORD}

# GCP Cloud Storage Configuration
gcp.project-id=${GCP_PROJECT_ID}
gcp.storage.bucket=${GCP_STORAGE_BUCKET:brewer-fotos}
gcp.credentials.location=${GOOGLE_APPLICATION_CREDENTIALS:}
gcp.credentials.json=${GCP_CREDENTIALS_JSON:}

# HikariCP Configuration - GCP Cloud SQL optimized
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JPA / Hibernate - Production
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.hibernate.ddl-auto=none
spring.jpa.open-in-view=false

# Thymeleaf - Production (enable cache)
spring.thymeleaf.cache=true

# Logging - Production (minimal)
logging.level.root=WARN
logging.level.com.algaworks.brewer=INFO
logging.level.com.algaworks.brewer.config.GCSConfig=INFO
logging.level.com.algaworks.brewer.storage.gcs=INFO
logging.level.org.hibernate.SQL=ERROR
logging.level.org.springframework.web=WARN
logging.level.org.springframework.security=WARN

# Log to stdout (recommended for GKE with Cloud Logging)
# Cloud Logging automatically collects stdout/stderr from containers
logging.file.name=${LOG_FILE_PATH:}

# Actuator - Production (restricted endpoints)
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=when-authorized

# Kubernetes-style probes for GKE
management.endpoint.health.probes.enabled=true
management.health.livenessState.enabled=true
management.health.readinessState.enabled=true
management.endpoint.health.group.liveness.include=livenessState
management.endpoint.health.group.liveness.show-details=always
management.endpoint.health.group.readiness.include=readinessState
management.endpoint.health.group.readiness.show-details=always

# Server - Production
server.port=${SERVER_PORT:8080}
server.compression.enabled=true
server.compression.mime-types=text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/json
server.compression.min-response-size=1024

# Session - Production
server.servlet.session.timeout=30m
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true

# DevTools - Disabled in production
spring.devtools.restart.enabled=false
spring.devtools.livereload.enabled=false

# Mail Configuration (if needed)
# spring.mail.host=${MAIL_HOST:smtp.gmail.com}
# spring.mail.port=${MAIL_PORT:587}
# spring.mail.username=${MAIL_USERNAME}
# spring.mail.password=${MAIL_PASSWORD}
# spring.mail.properties.mail.smtp.auth=true
# spring.mail.properties.mail.smtp.starttls.enable=true