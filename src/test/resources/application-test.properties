# Test Configuration
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false

# Use Flyway to create schema in tests (more reliable than Hibernate ddl-auto)
spring.jpa.hibernate.ddl-auto=none
spring.flyway.enabled=true
spring.flyway.clean-disabled=false
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=false

logging.level.org.hibernate.SQL=WARN

# Allow bean definition overriding (required for @DataJpaTest with custom repositories)
spring.main.allow-bean-definition-overriding=true

# Test Database Configuration
# CI will use MySQL service, local can use H2 or MySQL Docker
spring.datasource.url=${TEST_DB_URL:jdbc:mysql://localhost:3307/brewer_test?allowPublicKeyRetrieval=true&useSSL=false}
spring.datasource.username=${TEST_DB_USER:test}
spring.datasource.password=${TEST_DB_PASSWORD:test}
spring.datasource.driver-class-name=${TEST_DB_DRIVER:com.mysql.cj.jdbc.Driver}

# HikariCP Configuration for Tests
# Limit connection pool to avoid exhausting database connections when running many tests in parallel
spring.datasource.hikari.maximum-pool-size=2
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=60000

# Disable Spring Security for tests
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration,\
  org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration,\
  org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration

# Actuator - Test (disabled for integration tests)
management.endpoints.enabled-by-default=false